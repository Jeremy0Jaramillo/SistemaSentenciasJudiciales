<app-header></app-header>

<div class="titulo">
  <h2>Sistema Jurídico Avanzado de Sentencias de Primer Nivel en Ecuador</h2>
  <button *ngIf="userRole !== 'docente'" class="bttn-stnd" (click)="redirectToNuevaSentencia()">Nueva Sentencia</button>
</div>

<div class="search-bar">
  <input class="search" type="text" [(ngModel)]="searchText" (input)="onSearchTextChanged()"
    *ngIf="userRole == 'docente'" placeholder="Buscar por nombre de estudiante">
</div>

<div class="sentencias">
  <div *ngFor="let sentencia of filteredSentencias$ | async" class="sent">

    <div class="proceso">
      <p><strong>Numero de Proceso:</strong> {{ sentencia.numero_proceso }}</p>
    </div>

    <div class="datos">

      <div class="text-dat">
        <p><strong>Asunto:</strong> {{ sentencia.asunto }}</p>
      </div>

      <div class="text-dat">
        <p><strong>Estudiante:</strong> {{ sentencia.nombre_estudiante }}</p>
      </div>

      <div class="text-dat">
        <p><strong>Docente:</strong> {{ sentencia.nombre_docente }}</p>
      </div>
    </div>

    <div class="more">
      <button class="bttn-stnd" (click)="redirectToAnalisis(sentencia)" [disabled]="sentencia?.estado !== 'aceptar'">
        >Ver más</button>
      <a *ngIf="userRole === 'docente' && sentencia.archivoURL" [href]="sentencia.archivoURL" target="_blank"
        class="bttn-download">
        Descargar PDF
      </a>
    </div>
    <div class="bttn-acetp" *ngIf="userRole === 'docente' && !sentencia.estado">
      <button (click)="abrirRazon(sentencia, 'aceptar')" class="bttn-accept">Aceptar</button>
      <button (click)="abrirRazon(sentencia, 'negar')" class="bttn-reject">Negar</button>
    </div>

    <!-- Vista del estudiante -->
    <div *ngIf="userRole !== 'docente' && sentencia.estado">
      <button (click)="openOverlay(sentencia)" class="btn btn-outline-primary">Ver más</button>
    </div>
<!-- Overlay del estudiante -->
<div *ngIf="showOverlay" class="overlay">
  <div class="overlay-content">
    <div class="overlay-content-text">
      <p *ngIf="selectedSentencia?.estado == 'aceptar'" class="bttn-accept">Sentencia aceptada</p>
      <p *ngIf="selectedSentencia?.estado == 'negar'" class="bttn-reject">Sentencia negada</p>
      <p class="razon-est" *ngIf="selectedSentencia?.razon">
        <strong>Razón:</strong> {{ selectedSentencia?.razon }}
      </p>      
      <p *ngIf="!selectedSentencia?.razon">
        No se proporcionó una razón para esta decisión.
      </p>
    </div>
    <button (click)="closeOverlay()" class="btn btn-secondary">Cerrar</button>
  </div>
</div>
    <!-- Overlay para razón -->
    <div class="overlay" *ngIf="showRazonOverlay">
      <div class="overlay-content">
        <h3>Razón para {{ accionPendiente }} la sentencia</h3>
        <textarea [(ngModel)]="razonTexto" placeholder="Ingrese la razón..."></textarea>
        <div class="overlay-buttons">
          <button (click)="guardarDecision()">Guardar</button>
          <button (click)="cancelarDecision()">Cancelar</button>
        </div>
      </div>
    </div>
  </div>
</div>