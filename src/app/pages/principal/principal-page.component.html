<app-header></app-header>

<div class="titulo">
  <h2>Sistema Jurídico Avanzado de Sentencias de Primer Nivel en Ecuador</h2>
  <button *ngIf="userRole !== 'docente'" class="bttn-stnd" (click)="redirectToNuevaSentencia()">Nueva Sentencia</button>
</div>

<div class="search-bar">
  <input class="search" type="text" [(ngModel)]="searchText" (input)="onSearchTextChanged()"
    *ngIf="userRole == 'docente'" placeholder="Buscar por nombre de estudiante">
</div>

<div class="sentencias">
  <div *ngFor="let sentencia of filteredSentencias$ | async" class="sent">

    <div class="proceso">
      <p><strong>Numero de Proceso:</strong> {{ sentencia.numero_proceso }}</p>
    </div>

    <div class="datos">

      <div class="text-dat">
        <p><strong>Asunto:</strong> {{ sentencia.asunto }}</p>
      </div>

      <div class="text-dat">
        <p><strong>Estudiante:</strong> {{ sentencia.nombre_estudiante }}</p>
      </div>

      <div class="text-dat">
        <p><strong>Docente:</strong> {{ sentencia.nombre_docente }}</p>
      </div>
    </div>

    <div class="more">
      <button class="bttn-stnd" (click)="redirectToAnalisis(sentencia)">Ver más</button>
      <a *ngIf="userRole === 'docente' && sentencia.archivoURL" [href]="sentencia.archivoURL" target="_blank"
        class="bttn-download">
        Descargar PDF
      </a>
    </div>
    <div class="bttn-acetp" *ngIf="userRole === 'docente'">
      <button (click)="abrirRazon(sentencia, 'aceptar')" class="bttn-accept">Aceptar</button>
      <button (click)="abrirRazon(sentencia, 'negar')" class="bttn-reject">Negar</button>
    </div>

    <!-- Vista del estudiante -->
    <div class="estado-sentencia" *ngIf="userRole !== 'docente' && sentencia.estado">
      <div class="estado-badge" [ngClass]="sentencia.estado">
        Sentencia {{ sentencia.estado }}
      </div>
      <div class="razon-text" *ngIf="sentencia.razon">
        <strong>Razón:</strong> {{ sentencia.razon }}
      </div>
    </div>

    <!-- Overlay para razón -->
    <div class="overlay" *ngIf="showRazonOverlay">
      <div class="overlay-content">
        <h3>Razón para {{ accionPendiente }} la sentencia</h3>
        <textarea [(ngModel)]="razonTexto" placeholder="Ingrese la razón..."></textarea>
        <div class="overlay-buttons">
          <button (click)="guardarDecision()">Guardar</button>
          <button (click)="cancelarDecision()">Cancelar</button>
        </div>
      </div>
    </div>
  </div>
</div>